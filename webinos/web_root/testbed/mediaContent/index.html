<!DOCTYPE html>
<html>
<head>
  <script type="text/javascript" src="./jquery-1.8.2.min.js"></script>
  <script type="text/javascript" src="./webinos.js"></script>
  <script type="text/javascript">
    $('#serviceList').empty ();
    $(document).ready (function () {
      function printInfo (data) {
        $('#message').append ('<li>' + data.payload.message + '</li>');
      }
      webinos.session.addListener ('info', printInfo);
      jQuery("#btnFind").click(findService);
      jQuery("#btnBind").click(bindService);
      jQuery("#btnGetLocalFolders").click(getLocalFolders);
      jQuery("#btnFindItems").click(findItemInFolders);
    });

    var mediaContentService = null;
    var mediaContentServices =[];
    var mediaContent = null;

    function findService() {
      "use strict";
      webinos.discovery.findServices(new ServiceType ('http://webinos.org/api/mediacontent'), {onFound:function (service) {
        $('#serviceList').append ($ ('<option>' + service.serviceAddress + '</option>'));
        mediaContentServices[service.serviceAddress] = service;
        document.getElementById('position').innerHTML = "MediaContent service found";
      }});
    }

    function bindService() {
      "use strict";
      mediaContentService = mediaContentServices[$ ('#serviceList option:selected').val ()];
      mediaContentService.bindService ({onBind:function (service) {
        document.getElementById('position').innerHTML = "Bound MediaContent service";
      }});
    }

    function handle_errors() {
    }

    function folderDetails(folderDetails) {
      "use strict";
      var i;
      document.getElementById('displayDetails').innerHTML = "";
      var folderData = "<table border=2 cellpadding='2' cellspacing='2'>";
      folderData += "<tr><th>ID</th><th>Path</th><th>Name</th><th>Type</th><th>Date</th></tr>";
      for (i = 0; i < folderDetails.length; i = i + 1) {
        folderData += "<tr><td>" + folderDetails[i].id + "</td>";
        folderData += "<td>" + folderDetails[i].folderURI + "</td>";
        folderData += "<td>" + folderDetails[i].title + "</td>";
        folderData += "<td>" + folderDetails[i].storageType + "</td>";
        folderData += "<td>" + folderDetails[i].modifiedDate + "</td></tr>";
      }
      folderData += "</table>";
      document.getElementById('displayDetails').innerHTML = folderData;
    }

    function itemDetails(folderDetails) {
      "use strict";
      var i;
      document.getElementById('displayDetails').innerHTML = "";
      var folderData = "<table border=2 cellpadding='2' cellspacing='2'><tr>";
      folderData += "<th>Title</th><th>Path</th><th>Type</th><th>Size</th><th>Date</th>";
      folderData += "<th>Album</th><th>Artists</th><th>Duration</th><th>Width</th><th>Height</th>";
      folderData += "<th>TrackNumber</th><th>BitRate</th>";
      folderData += "</tr>";
      for (i = 0; i < folderDetails.length; i = i + 1) {
        /*if (folderDetails[i].type === "Image") { folderData += "<tr>"+createObjectURL(folderDetails[i])+"</tr>";}*/
        folderData += "<tr> <td>" + folderDetails[i].title + "</td>";
        folderData += "<td>" + folderDetails[i].itemURI + "</td>";
        folderData += "<td>" + folderDetails[i].type + " ("+ folderDetails[i].mimeType + ")</td>";
        folderData += "<td>" + folderDetails[i].size + "</td>";
        folderData += "<td>" + folderDetails[i].modifiedDate + "</td>";
        if (folderDetails[i].type === "Video") {
          folderData += "<td>" + folderDetails[i].album + "</td>";
          folderData += "<td>" + folderDetails[i].artists + "</td>";
          folderData += "<td>" + folderDetails[i].duration + "</td>";
          folderData += "<td>" + folderDetails[i].width + "</td>";
          folderData += "<td>" + folderDetails[i].height + "</td>";
        }
        else if (folderDetails[i].type === "Audio") {
          folderData += "<td>" + folderDetails[i].album + "</td>";
          folderData += "<td>" + folderDetails[i].artists + "</td>";
          folderData += "<td>" + folderDetails[i].duration + "</td>";
          folderData += "<td></td><td></td>";
          folderData += "<td>" + folderDetails[i].trackNumber + "</td>";
          folderData += "<td>" + folderDetails[i].bitrate + "</td>";
        }
        else if (folderDetails[i].type === "Image") {
          folderData += "<td></td><td></td><td></td>";
          folderData += "<td>" + folderDetails[i].width + "</td>";
          folderData += "<td>" + folderDetails[i].height + "</td>";
          folderData += "<td></td><td></td>";
        }
        folderData += "</tr>";
      }
      folderData += "</table>";
      document.getElementById('displayDetails').innerHTML = folderData;
    }



    function getLocalFolders() {
      if(mediaContentService) {
        mediaContentService.getLocalFolders(folderDetails, handle_errors);
      }
    }

    function findItemInFolders() {
      if(mediaContentService) {
        mediaContentService.findItem(itemDetails, handle_errors);
      }
    }
  </script>
</head>
<body>

<p><div style="background-color:lightgray; border:1px solid black">
  PZH PZP LIST :
  <select id="serviceList">
    <option></option>
  </select>
</div></p>


<p><div>
  <button id="btnFind">Find MediaContent Service</button>
  <button id="btnBind">Bind MediaContent Service</button>
  <button id="btnGetLocalFolders"> Get Local Folder</button>
  <button id="btnFindItems"> FindContents in Folder</button>
</div></p>
<p><div id="position"></div></p>
<p><div id="displayDetails"></div></p>

</body>
</html>
